<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header">Products</h1>
  </div>
</div>

<div>
  <div class="panel panel-default">
    <div class="panel-heading">Products</div>
    <div class="panel-body">
      <p id="notice"><%= notice %></p>

      <% @products.each do |product| %>
        <div class="col-md-3 col-sm-12 product">
          <%= image_tag product.image.url, size: "400x250", class: 'img-responsive'  %>
          <h4 class="product-title"><%= product.name %></h4>
          <button type="button" class="btn btn-success fa fa-plus js-add-button"
            data-product-id="<%= product.id %>"
            data-product-name="<%= product.name %>">Adicionar
          </button>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
var order = {};

$('.js-add-button').click(function(){
  product_id = $(this).data('product-id');
  product_name = $(this).data('product-name');

  item = order[product_id];

  if (item == undefined) {
    order[product_id] = {
      name: product_name,
      qtd: 1
    }
  } else {
    item['qtd'] += 1;
  }

  $('#order').val(JSON.stringify(order));
})

</script>

